import{useState as n,useEffect as e,useMemo as t,useSyncExternalStore as i,useCallback as o}from"react";let r;const s=new Uint8Array(16);function a(){if(!r&&(r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!r))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(s)}const d=[];for(let n=0;n<256;++n)d.push((n+256).toString(16).slice(1));var c={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function u(n,e,t){if(c.randomUUID&&!e&&!n)return c.randomUUID();const i=(n=n||{}).random||(n.rng||a)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,e){t=t||0;for(let n=0;n<16;++n)e[t+n]=i[n];return e}return function(n,e=0){return d[n[e+0]]+d[n[e+1]]+d[n[e+2]]+d[n[e+3]]+"-"+d[n[e+4]]+d[n[e+5]]+"-"+d[n[e+6]]+d[n[e+7]]+"-"+d[n[e+8]]+d[n[e+9]]+"-"+d[n[e+10]]+d[n[e+11]]+d[n[e+12]]+d[n[e+13]]+d[n[e+14]]+d[n[e+15]]}(i)}const f=["channel/disconnect","channel/response","channel/heartbeat"],p=["handshake/syn","handshake/syn-ack","handshake/ack"],l=n=>f.some((e=>e===n)),h=n=>p.some((e=>e===n)),y=({data:n={}})=>"object"==typeof n&&null!==n&&!Array.isArray(n)&&!("domain"in n)&&["id","type","from","to"].every((e=>e in n))&&n.type.startsWith("handshake/");function m(n){const e=window.self!==window.top,t={buffer:[],id:null,origin:null,status:"connecting"};function i(e,i){if(h(e)||l(e)||"connecting"!==t.status&&"reconnecting"!==t.status){if(t.id&&t.origin){const o={connectionId:t.id,data:i,domain:"sanity/channels",from:n.id,id:u(),to:n.connectTo,type:e};try{parent.postMessage(o,{targetOrigin:t.origin})}catch(e){throw new Error(`Failed to postMessage '${o.id}' on '${n.id}'`)}}}else t.buffer.push({type:e,data:i})}function o(e){if(y(e))console.error("Visual editing package mismatch detected! Please ensure you are using the latest version of Sanity Studio and any packages listed here:\nhttps://github.com/sanity-io/visual-editing");else if(function(e){const{data:t}=e;return"sanity/channels"===t.domain&&t.to===n.id&&t.from===n.connectTo&&"channel/response"!==t.type}(e)){const{data:o}=e;if(h(o.type)&&o.data){if("handshake/syn"===o.type)return t.origin=e.origin,t.id=o.data.id,r("connecting"),void i("handshake/syn-ack",{id:t.id});if("handshake/ack"===o.type&&o.data.id===t.id)return void r("connected")}else if(o.connectionId===t.id&&e.origin===t.origin){if("channel/disconnect"===o.type)return void r("disconnected");{const e=[o.type,o.data];n.onEvent?.(...e),i("channel/response",{responseTo:o.id})}return}}}function r(e){t.status=e,n?.onStatusUpdate?.(e),"connected"===e&&function(){const n=[...t.buffer];t.buffer.splice(0,t.buffer.length),n.forEach((({type:n,data:e})=>{i(n,e)}))}()}return window.addEventListener("message",o,!1),r("connecting"),{destroy:function(){["disconnected"].includes(t.status)||r("disconnected"),window.removeEventListener("message",o,!1)},inFrame:e,send:function(n,e){i(n,e)}}}function g(t,i,o){const[r,s]=n(),[a,d]=n(!1);e((()=>{if(window.self===window.top)return;const n=m({id:"preview-kit",connectTo:"presentation",onStatusUpdate(n){"connected"===n?d(!0):"disconnected"===n&&d(!1)}}),e=setTimeout((()=>s(n)),0);return()=>{clearTimeout(e),n.destroy(),s(void 0)}}),[o,i]);const c=JSON.stringify(Array.from(t.keys()));e((()=>{"[]"!==c&&r&&a&&r.send("preview-kit/documents",{projectId:i,dataset:o,perspective:"previewDrafts",documents:Array.from(t.values())})}),[c,r,a,o,t,i])}function v(n){const e=t((()=>JSON.stringify(n||{})),[n]);return t((()=>JSON.parse(e)),[e])}function w(t){const{refreshInterval:r}=t,s=function(){const[t,o]=n(!1);e((()=>{o(navigator.onLine);const n=()=>o(!0),e=()=>o(!1);return window.addEventListener("online",n),window.addEventListener("offline",e),()=>{window.removeEventListener("online",n),window.removeEventListener("offline",e)}}),[]);const r=i(k,(()=>document.visibilityState),(()=>"hidden"));return!t||"hidden"===r}(),[a,d]=n("hit"),c=o((()=>(d("inflight"),()=>d("hit"))),[]);return e((()=>{if(!r||"hit"!==a)return;const n=setTimeout((()=>d("stale")),r);return()=>clearTimeout(n)}),[r,a]),e((()=>{if("hit"!==a)return;const n=()=>d("stale");return window.addEventListener("focus",n),()=>window.removeEventListener("focus",n)}),[r,a]),e((()=>{s&&"hit"===a&&d("stale"),s||"stale"!==a||d("refresh")}),[s,a]),[a,c]}function k(n){return document.addEventListener("visibilitychange",n),()=>document.removeEventListener("visibilitychange",n)}export{g as useDocumentsInUse,v as useQueryParams,w as useRevalidate};//# sourceMappingURL=index.js.map
